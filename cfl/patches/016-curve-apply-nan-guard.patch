--- a/IccProfLib/IccTagLut.cpp
+++ b/IccProfLib/IccTagLut.cpp
@@ -579,6 +579,10 @@
 icFloatNumber CIccTagCurve::Apply(icFloatNumber v) const
 {
+  // CFL patch: guard against NaN before clamp and uint32 cast.
+  // NaN fails both < and > comparisons, propagating to line 584 where
+  // (icUInt32Number)(NaN * m_nMaxIndex) is undefined behavior.
+  if (std::isnan(v)) v = 0.0;
   if(v<0.0) v = 0.0;
   else if(v>1.0) v = 1.0;
 
