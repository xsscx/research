diff --git a/IccProfLib/IccMpeCalc.cpp b/IccProfLib/IccMpeCalc.cpp
index 7bb3a4a..b8d6159 100644
--- a/IccProfLib/IccMpeCalc.cpp
+++ b/IccProfLib/IccMpeCalc.cpp
@@ -3976,11 +3976,19 @@ bool CIccCalculatorFunc::NeedTempReset(icUInt8Number *tempUsage, icUInt32Number
 * 
 * Return: 
 ******************************************************************************/
-bool CIccCalculatorFunc::SequenceNeedTempReset(SIccCalcOp *op, icUInt32Number nOps, icUInt8Number *tempUsage, icUInt32Number nMaxTemp)
+bool CIccCalculatorFunc::SequenceNeedTempReset(SIccCalcOp *op, icUInt32Number nOps, icUInt8Number *tempUsage, icUInt32Number nMaxTemp, icUInt32Number *pOpsProcessed)
 {
   icUInt32Number i, j;
+  icUInt32Number nLocalOps = 0;
+  if (!pOpsProcessed)
+    pOpsProcessed = &nLocalOps;
+
+  // Guard against excessive computation from crafted calculator ops
+  static const icUInt32Number kMaxOpsProcessed = 1000000;
 
   for (i=0; i<nOps; i++) {
+    if (++(*pOpsProcessed) > kMaxOpsProcessed)
+      return true;
     icSigCalcOp sig = op[i].sig;
     if (sig==icSigTempGetChanOp) {
       icUInt32Number p = op[i].data.select.v1;
@@ -4015,7 +4023,7 @@ bool CIccCalculatorFunc::SequenceNeedTempReset(SIccCalcOp *op, icUInt32Number nO
         free(ifTemps);
         return true;
       }
-      rv = rv || SequenceNeedTempReset(&op[p], icIntMin(nOps-p, op[i].data.size), ifTemps, nMaxTemp);
+      rv = rv || SequenceNeedTempReset(&op[p], icIntMin(nOps-p, op[i].data.size), ifTemps, nMaxTemp, pOpsProcessed);
 
       if (i<nOps && op[i+1].sig==icSigElseOp) {
         icUInt8Number *elseTemps = (icUInt8Number *)malloc(nMaxTemp);
@@ -4032,7 +4040,7 @@ bool CIccCalculatorFunc::SequenceNeedTempReset(SIccCalcOp *op, icUInt32Number nO
           free(elseTemps);
           return true;
         }
-        rv = rv || SequenceNeedTempReset(&op[p], icIntMin(nOps-p, op[i+1].data.size), elseTemps, nMaxTemp);
+        rv = rv || SequenceNeedTempReset(&op[p], icIntMin(nOps-p, op[i+1].data.size), elseTemps, nMaxTemp, pOpsProcessed);
 
         if (!rv) {
           for (j=0; j<nMaxTemp; j++) {
diff --git a/IccProfLib/IccMpeCalc.h b/IccProfLib/IccMpeCalc.h
index 3d93ac5..2e38c24 100644
--- a/IccProfLib/IccMpeCalc.h
+++ b/IccProfLib/IccMpeCalc.h
@@ -402,7 +402,7 @@ protected:
   bool InitSelectOps();
   bool InitSelectOp(SIccCalcOp *ops, icUInt32Number nOps);
 
-  bool SequenceNeedTempReset(SIccCalcOp *op, icUInt32Number nOps, icUInt8Number *tempUsage, icUInt32Number nMaxTemp);
+  bool SequenceNeedTempReset(SIccCalcOp *op, icUInt32Number nOps, icUInt8Number *tempUsage, icUInt32Number nMaxTemp, icUInt32Number *pOpsProcessed = NULL);
 
   void InsertBlanks(std::string &sDescription, int nBlanks);
   void DescribeSequence(std::string &sDescription,
