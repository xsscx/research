diff --git a/IccProfLib/IccMpeCalc.cpp b/IccProfLib/IccMpeCalc.cpp
index 41c8e46..b1a2c3d 100644
--- a/IccProfLib/IccMpeCalc.cpp
+++ b/IccProfLib/IccMpeCalc.cpp
@@ -4079,11 +4079,15 @@ bool CIccCalculatorFunc::NeedTempReset(icUInt8Number *tempUsage, icUInt32Number
 * Return: 
 ******************************************************************************/
-int CIccCalculatorFunc::CheckUnderflowOverflow(SIccCalcOp *op, icUInt32Number nOps, int nArgs, bool bCheckUnderflow, std::string &sReport) const
+int CIccCalculatorFunc::CheckUnderflowOverflow(SIccCalcOp *op, icUInt32Number nOps, int nArgs, bool bCheckUnderflow, std::string &sReport, icUInt32Number nRecurseDepth) const
 {
   icUInt32Number i, p;
   int nIfArgs, nElseArgs, nSelArgs, nCaseArgs;
 
+  static const icUInt32Number kMaxRecurseDepth = 100;
+
+  if (nRecurseDepth > kMaxRecurseDepth)
+    return -1;
 
   for (i=0; i<nOps; i++) {
     int nArgsUsed = op[i].ArgsUsed(m_pCalc);
@@ -4128,7 +4132,7 @@ int CIccCalculatorFunc::CheckUnderflowOverflow(SIccCalcOp *op, icUInt32Number nO
         p = i+2; 
         if (p > nOps)
           return -1;
-        nIfArgs = CheckUnderflowOverflow(&op[p], icIntMin(nOps-p, op[i].data.size), nArgs, bCheckUnderflow, sReport);
+        nIfArgs = CheckUnderflowOverflow(&op[p], icIntMin(nOps-p, op[i].data.size), nArgs, bCheckUnderflow, sReport, nRecurseDepth + 1);
         if (nIfArgs<0)
           return -1;
         incI =op[i].data.size;
@@ -4136,7 +4140,7 @@ int CIccCalculatorFunc::CheckUnderflowOverflow(SIccCalcOp *op, icUInt32Number nO
         p = i+2+op[i].data.size;
         if (p > nOps)
           return -1;
-        nElseArgs = CheckUnderflowOverflow(&op[p], icIntMin(nOps-p, op[i+1].data.size), nArgs, bCheckUnderflow, sReport);
+        nElseArgs = CheckUnderflowOverflow(&op[p], icIntMin(nOps-p, op[i+1].data.size), nArgs, bCheckUnderflow, sReport, nRecurseDepth + 1);
         if (nElseArgs<0)
           return -1;
         incI += op[i+1].data.size;
@@ -4149,7 +4153,7 @@ int CIccCalculatorFunc::CheckUnderflowOverflow(SIccCalcOp *op, icUInt32Number nO
         p = i+1; 
         if (p > nOps)
           return -1;
-        nIfArgs = CheckUnderflowOverflow(&op[p], icIntMin(nOps-p, op[i].data.size), nArgs, bCheckUnderflow, sReport);
+        nIfArgs = CheckUnderflowOverflow(&op[p], icIntMin(nOps-p, op[i].data.size), nArgs, bCheckUnderflow, sReport, nRecurseDepth + 1);
         if (nIfArgs<0)
           return -1;
         nArgs = bCheckUnderflow ? icIntMin(nArgs, nIfArgs) : icIntMax(nArgs, nIfArgs);
@@ -4185,7 +4189,7 @@ int CIccCalculatorFunc::CheckUnderflowOverflow(SIccCalcOp *op, icUInt32Number nO
         if (pos > nOps)
           return -1;
-        nCaseArgs = CheckUnderflowOverflow(&op[pos], icIntMin(nOps-pos, len), nArgs, bCheckUnderflow, sReport);
+        nCaseArgs = CheckUnderflowOverflow(&op[pos], icIntMin(nOps-pos, len), nArgs, bCheckUnderflow, sReport, nRecurseDepth + 1);
         if (nCaseArgs<0)
           return -1;
 
diff --git a/IccProfLib/IccMpeCalc.h b/IccProfLib/IccMpeCalc.h
index ad1e40c..f2c3e5a 100644
--- a/IccProfLib/IccMpeCalc.h
+++ b/IccProfLib/IccMpeCalc.h
@@ -388,7 +388,7 @@ protected:
 
   icUInt32Number GetMaxTemp() const;
-  int CheckUnderflowOverflow(SIccCalcOp *op, icUInt32Number nOps, int nArgs, bool bCheckUnderflow, std::string &sReport) const;
+  int CheckUnderflowOverflow(SIccCalcOp *op, icUInt32Number nOps, int nArgs, bool bCheckUnderflow, std::string &sReport, icUInt32Number nRecurseDepth = 0) const;
   icFuncParseStatus DoesStackUnderflowOverflow(std::string &sReport) const;
   bool HasValidOperations(std::string &sReport) const;
   bool HasUnsupportedOperations(std::string &sReport, const CIccProfile *pProfile) const;
